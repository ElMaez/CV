---
const educations = await fetch(
  "https://wnstsgdtfjtdgnznycir.supabase.co/rest/v1/Education?select=*",
  {
    method: "GET",
    headers: {
      apikey:
        "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Induc3RzZ2R0Zmp0ZGduem55Y2lyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDA1OTQ0NDEsImV4cCI6MjA1NjE3MDQ0MX0.gWutEk68vgYO18NOAbycXzhb1JJXOiGhCMSr5Szp3lo",
    },
  }
).then((educationsList) => educationsList.json());

console.log(educations);
---

<section id="education" class="educationContainer">
  <div id="educationTitel">
    <h2>Education</h2>
    <div class="h2Underline"></div>
  </div>
  <div class="slider">
    <div class="list">
      {
        educations.map((education) => {
          return (
            <div id={education.slug} class="item">
              <h3>{education.place}</h3>
              <h4>{education.titel}</h4>
              <ul>
                <li class="point_1">{education.punkt1}</li>
                <li class="point_2">{education.punkt2}</li>
                <li class="point_3">{education.punkt3}</li>
                <li class="point_4">{education.punkt4}</li>
              </ul>
            </div>
          );
        })
      }
    </div>
    <div id="educationsliderNav">
      <a href="#" id="previous"><i class="fa-solid fa-angle-left fa-2xl"></i></a
      >
      <div id="educationsliderDots"></div>
      <a href="#" id="next"><i class="fa-solid fa-angle-right fa-2xl"></i></a>
    </div>
  </div>
</section>

<script>
  import { addIssueToContext } from "astro:schema";

  const educations = await fetch(
    "https://wnstsgdtfjtdgnznycir.supabase.co/rest/v1/Education?select=*",
    {
      method: "GET",
      headers: {
        apikey:
          "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Induc3RzZ2R0Zmp0ZGduem55Y2lyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDA1OTQ0NDEsImV4cCI6MjA1NjE3MDQ0MX0.gWutEk68vgYO18NOAbycXzhb1JJXOiGhCMSr5Szp3lo",
      },
    }
  ).then((educationsList) => educationsList.json());

  educations.forEach((education) => {
    let slug = education.slug;
    if (education.id) {
      document.getElementById("educationsliderDots")!.innerHTML +=
        `<a href="#${slug}"><i class="active fa-sharp fa-regular fa-circle fa-xl" style="color: black"></i></a>`;
      // } if else (education.id) {
      //   document.getElementById("educationsliderDots")!.innerHTML +=
      //   `<a href="#${slug}"><i class="active fa-sharp fa-regular fa-circle fa-xl" style="color: black"></i></a>`;
      // } else {
      console.log("NÃ¥");
    }
  });
  // Slider
  let list = document.querySelector(".slider .list");
  let item = document.querySelectorAll(".slider .list .item");
  let dots = document.querySelectorAll(".slider .dots a");
  let prev = document.getElementById("prev");
  let next = document.getElementById("next");

  let active = 0;
  let legthItems = item.length;

  next.onclick = function () {
    if (active + 1 > legthItems) {
      active = 0;
    } else {
      active = active + 1;
    }
    reloadSlider();
  };
  prev.onclick = function () {
    if (active - 1 > 0) {
      active = legthItems;
    } else {
      active = active - 1;
    }
    reloadSlider();
  };

  let refreshSlider = setInterval(() => {
    next.click();
  }, 3000);
  function reloadSlider() {
    let checkLeft = item[active].offsetLeft;
    list.style.left = -checkLeft + "px";

    let lastActiveDot = document.querySelector(".slider .dots i.active");
    lastActiveDot.classList.remove("active");
    dots[active].classList.add("active");
    clearInterval(refreshSlider);
    let refreshSlider = setInterval(() => {
      next.click();
    }, 3000);
  }

  dots.forEach((a, key) => {
    a.addEventListener("click", function () {
      active = key;
      reloadSlider();
    });
  });
</script>

<style>
  /* Slider */
  .slider {
    outline: dashed 2px red;
    width: 1300px;
    max-width: 100vw;
    height: 400px;
    margin-inline: auto;
    position: relative;
    /* overflow: hidden; */
  }
  .list {
    position: absolute;
    top: 0;
    left: 0;
    height: 100%;
    display: flex;
    width: max-content;
  }
  .list .item {
    width: 1300px;
    max-width: 100vw;
    height: 100%;
    object-fit: cover;
  }
  #educationsliderNav {
    position: absolute;
    top: 45%;
    left: 5%;
    width: 90%;
    display: flex;
    justify-content: space-between;
  }

  #educationsliderDots {
    position: absolute;
    bottom: 10px;
    left: 0;
    width: 100%;
    margin: 0;
    padding: 0;
    display: flex;
    justify-content: center;
  }
  #educationsliderDots .active {
    background-color: aquamarine;
  }
</style>
